﻿<PageTitle>Home</PageTitle>
@page "/"

@inherits LayoutComponentBase
@rendermode InteractiveServer

@* @using Microsoft.AspNetCore.Components.Authorization
@using WebApp.Authentication
@using WebApp.Authentication
@inject AuthenticationStateProvider AuthStateProvider *@
@* @inject NavigationManager NavigationManager *@
@* @inject IJSRuntime JSRuntime *@

<!-- Topbar -->
<Top />


<!-- Sidebar -->
<nav class="sidebar">
    <div class="nav-side">
        <p>TOP 10 FILM</p>
        <ul class="liste">
            <li>Alle</li>
            <li>Action</li>
            <li>Animation</li>
            <li>Drama</li>
            <li>Fantasy</li>
            <li>Komedie</li>
            <li>Gyser</li>
            <li>Krimi</li>
            <li>Musical</li>
            <li>Romantik</li>
            <li>Thriller</li>
            <li>Western</li>
        </ul>
    </div>
</nav>

<!-- Top film sektion -->
<nav class="top-movie">
    <div class="left">
        @if (randomLeft != null)
        {

            <div class="content">
                <h1>@randomLeft.Titel</h1>
                <p>@randomLeft.Synopse</p>
                <p class="line">
                    <span>Udgivet: @randomLeft.Udgivelsesdato</span>
                    <span>Rating: @randomLeft.Gennemsnitsanmeldelse</span>
                </p>
            </div>
            <button class="topButtom" @onclick="() => NavigateToFilmDetails(randomLeft.Id)">
                <img src="@ConvertToImageUrl(randomLeft.Plakat)" alt="Random Left Film Image" />
            </button>
        }
    </div>
    <div class="right">
        @if (randomRight != null)
        {
            <div class="content">
                <h1>@randomRight.Titel</h1>
                <p>@randomRight.Synopse</p>
                <p class="line">
                    <span>Udgivet: @randomRight.Udgivelsesdato</span>
                    <span>Rating: @randomRight.Gennemsnitsanmeldelse</span>
                </p>
            </div>
            <button class="topButtom" @onclick="() => NavigateToFilmDetails(randomRight.Id)">
                <img src="@ConvertToImageUrl(randomRight.Plakat)" alt="Random Right Film Image" />
            </button>
        }
    </div>
</nav>

<!-- Seneste film -->
<nav class="row">
    <div>
        <h1>Seneste Upload</h1>
        <ul>
            @if (latestFilms != null && latestFilms.Any())
            {
                @foreach (var film in latestFilms)
                {
                    <li>
                        <button @onclick="() => NavigateToFilmDetails(film.Id)">
                            <img src="@ConvertToImageUrl(film.Plakat)" alt="Film Plakat" />
                            <p>@film.Titel</p>
                        </button>
                    </li>
                }
            }
        </ul>
    </div>
</nav>

<AuthorizeView>
    <Authorized>
        <nav class="row">
            <div>
                <h1>dine anmeldelse</h1>
                <ul>
                    @if (latestFilms != null && latestFilms.Any())
                    {
                        @foreach (var film in latestFilms)
                        {
                            <li>
                                <button type="button" @onclick="() => NavigateToFilmDetails(film.Id)">
                                    <img src="@ConvertToImageUrl(film.Plakat)" alt="Film Plakat" />
                                    <p>@film.Titel</p>
                                </button>
                            </li>
                        }
                    }
                </ul>
            </div>
        </nav>
    </Authorized>
</AuthorizeView>

<style>

    body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    /* Sidebar */
    .sidebar {
        width: 200px;
        height: 100%;
        border-right: 1px solid #ccc;
        padding: 10px;
        position: fixed;
        top: 50px; /* Under topbar */
        left: 0;
        text-align: center;
        padding-top: 10vh;
    }

    .nav-side p {
        font-size: 1.2rem;
        margin-bottom: 10px;
    }

    .liste {
        list-style-type: none;
        padding: 0;
    }

        .liste li {
            margin-bottom: 5px;
            cursor: pointer;
        }

    /* Top Movie Section */
    .topButtom{
        border:none;
        background:none;
    }

    .top-movie {
        display: flex;
        justify-content: space-around;
        margin-left: 220px; /* Afstand fra sidebar */
        margin-top: 50px; /* Forøget afstand fra toppen */
        gap: 20px;
    }

        .top-movie .left, .top-movie .right {
            width: 100%; /* Fylder tilgængelig plads */
            max-width: 750px; /* Maksimal bredde på kassen */
            max-height: 225px; /* Maksimal højde på kassen */
            border: 1px solid #ccc; /* Synlig kantlinje */
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box; /* Inkluder padding og border i størrelsen */
        }

        .top-movie .content {
            flex: 1;
            margin-right: 10px; /* Giver plads mellem tekst og billede */
            overflow: hidden; /* Skjuler tekst, hvis det bliver for langt */
            text-overflow: ellipsis; /* Tilføjer "..." hvis nødvendigt */
            white-space: normal; /* Tillader flere linjer */
            max-height: 200px; /* Begrænser højden på tekstområdet */
            display: -webkit-box; /* Gør det muligt at begrænse linjer */
            -webkit-line-clamp: 5; /* Maksimalt antal linjer (justér efter behov) */
            -webkit-box-orient: vertical; /* Retningen af tekstblokken */
        }

        .top-movie img {
            width: 150px; /* Fast bredde på billedet */
            height: 200px; /* Fast højde på billedet */
            border: 1px solid #ccc;
            border-radius: 5px;
            object-fit: cover; /* Sørger for, at billedet fylder proportionelt */
            border:none;
        }

        /* Teksten bliver mindre, hvis kassen når maksimal størrelse */
        .top-movie .content h1 {
            font-size: 1.5rem; /* Normal størrelse */
            font-size: calc(1.5rem - 0.3vw); /* Dynamisk størrelse */
            margin: 0 0 10px 0; /* Giver afstand til efterfølgende tekst */
        }

        .top-movie .content p {
            font-size: 1rem; /* Normal størrelse */
            font-size: calc(1rem - 0.2vw); /* Dynamisk størrelse */
            margin: 0; /* Fjerner unødvendig margin */
            line-height: 1.5; /* Gør teksten mere læsbar */
        }

    .line {
        display: flex;
        gap: 20px; /* Afstand mellem span-elementer */
        margin: 0; /* Fjerner ekstra margin omkring linjen */
        flex-wrap: wrap; /* Tillader linjeskift, hvis nødvendigt */
    }

        .line span {
            display: inline-block; /* Sørger for, at de optræder inline */
            margin-top: 5px; /* Giver lidt afstand til toppen */
            font-size: 0.9rem; /* Juster teksten efter behov */
        }






    /* Latest Movies Section */
    .row {
        margin-left: 220px; /* Afstand fra sidebar */
        margin-top: 20px;
    }

        .row h1 {
            font-size: 1.5rem;
        }

        .row ul {
            list-style-type: none;
            display: flex;
            gap: 15px;
            padding: 0;
            justify-content: space-between; /* Fordel pladsen jævnt */
        }

            .row ul li {
                text-align: center;
                flex: 1; /* Sørger for, at elementerne fylder ens */
                max-width: 150px; /* Sætter en fast bredde */
                height: auto; /* Lader højden justeres efter indholdet */
            }

                .row ul li img {
                    width: 150px; /* Fast bredde */
                    height: 200px; /* Fast højde */
                    object-fit: cover; /* Sørger for, at billedet fylder uden at strække */
                    /* margin-bottom: 5px; */
                    border: none; /* Fjerner billedets kantlinje */
                }

                .row ul li button {
                    background: none; /* Fjerner baggrundsfarve */
                    border: none; /* Fjerner kantlinje */
                    padding: 0; /* Fjerner ekstra plads */
                }

                .row ul li p {
                    margin-top: 5px;
                    font-size: 0.9rem; /* Juster tekststørrelse */
                    text-align: center;
                }

</style>

@code {
    private FilmDto? randomLeft;
    private FilmDto? randomRight;

    private List<FilmDto>? latestFilms;

    protected override async Task OnInitializedAsync()
    {
        // Hent de seneste 8 film ved hjælp af ImageService
        latestFilms = await Filmservies.GetLatestFilmsAsync();

        var randomFilms = await Filmservies.GetTwoUniqueRandomFilmsAsync();

        randomLeft = randomFilms.Dequeue();
        randomRight = randomFilms.Dequeue();
    }
    // Metode til at konvertere byte-array til Base64-URL for billedvisning
    private string ConvertToImageUrl(byte[] imageBytes)
    {
        return $"data:image/jpeg;base64,{Convert.ToBase64String(imageBytes)}";
    }

    private void NavigateToFilmDetails(int filmId)
    {
        NavigationManager.NavigateTo($"/FilmDetails/{filmId}");
    }
}